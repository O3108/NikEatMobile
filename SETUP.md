# Инструкция по настройке NikEat Mobile

## Быстрый старт

### 1. Установка зависимостей

```bash
npm install
```

### 2. Настройка API

Создайте файл `.env` в корне проекта:

```bash
cp .env.example .env
```

Отредактируйте `.env` и укажите URL вашего API:

```env
EXPO_PUBLIC_API_URL=https://your-app.vercel.app
```

**Важно:** Если вы используете веб-версию `nik-eat-web`, укажите URL вашего деплоя на Vercel.

### 3. Запуск приложения

```bash
# Используйте Node.js 20+
source ~/.nvm/nvm.sh && nvm use 20.19.5 && npm start
```

### 4. Открытие на устройстве

- **iOS**: Нажмите `i` в терминале или отсканируйте QR-код в Expo Go
- **Android**: Нажмите `a` в терминале или отсканируйте QR-код в Expo Go
- **Web**: Нажмите `w` в терминале

## Подключение к локальному серверу

Если вы запускаете веб-версию локально:

1. Запустите веб-версию:
```bash
cd ../nik-eat-web
npm run dev
```

2. В `.env` укажите:
```env
EXPO_PUBLIC_API_URL=http://localhost:3000
```

**Примечание:** На физическом устройстве используйте IP-адрес вашего компьютера вместо `localhost`:
```env
EXPO_PUBLIC_API_URL=http://192.168.1.100:3000
```

## Режимы работы

### Онлайн режим
- Приложение синхронизируется с сервером
- Все изменения сохраняются в облаке
- Индикатор показывает "Онлайн" (зеленый)

### Офлайн режим
- Приложение работает с локальными данными
- Изменения сохраняются на устройстве
- Индикатор показывает "Офлайн" (оранжевый)
- При восстановлении связи данные синхронизируются

## Структура данных

Приложение хранит:
- **Продукты** - список продуктов с ХЕ
- **Настройки** - дозы инсулина
- **Активный инсулин** - текущая доза и время
- **Глюкоза** - статистика дневной/ночной глюкозы

Все данные сохраняются локально в AsyncStorage и синхронизируются с сервером.

## Troubleshooting

### Ошибка подключения к API

Если видите "Офлайн" режим:
1. Проверьте URL в `.env`
2. Убедитесь, что сервер запущен
3. Проверьте интернет-соединение
4. На физическом устройстве - проверьте, что устройство и компьютер в одной сети

### Приложение не запускается

1. Убедитесь, что используете Node.js 20+:
```bash
node --version
```

2. Очистите кеш:
```bash
npm start -- --clear
```

3. Переустановите зависимости:
```bash
rm -rf node_modules package-lock.json
npm install
```

### Данные не синхронизируются

1. Проверьте индикатор статуса в приложении
2. Проверьте консоль на наличие ошибок
3. Убедитесь, что API endpoints доступны
4. Проверьте CORS настройки на сервере

## Полезные команды

```bash
# Запуск с очисткой кеша
npm start -- --clear

# Запуск на конкретном порту
npm start -- --port 8082

# Проверка версии Node.js
node --version

# Просмотр логов
npx expo start --dev-client
```

## Дополнительная информация

Подробная документация в [README.md](./README.md)
